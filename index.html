<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bucket Jump: Slosh Edition ü™£</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; user-select: none; margin: 0; padding: 0; }
        body {
            background: #1a1a2e;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
            color: #fff;
        }
        .game-wrapper {
            background: #16213e;
            border: 6px solid #4dd0e1;
            padding: 10px;
            border-radius: 25px;
            box-shadow: 0 0 50px rgba(77, 208, 225, 0.3);
            position: relative;
        }
        canvas {
            display: block;
            width: 100%;
            max-width: 900px;
            aspect-ratio: 16 / 9;
            border-radius: 15px;
            background: #0f3460;
        }
        .ui-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 15px;
        }
        .stat {
            background: rgba(255,255,255,0.1);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        #menuOverlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 52, 96, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            border-radius: 20px;
        }
        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Fredoka One';
            box-shadow: 0 5px 0 #950740;
            transition: 0.1s;
        }
        button:active { transform: translateY(3px); box-shadow: 0 2px 0 #950740; }
        .progress-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        #progressBar { width: 0%; height: 100%; background: #4dd0e1; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="game-wrapper">
    <div class="progress-container"><div id="progressBar"></div></div>
    <canvas id="gameCanvas" width="900" height="500"></canvas>

    <div class="ui-bar">
        <div class="stat">LEVEL <span id="levelDisplay">1</span></div>
        <div class="stat" style="color: #ffd700">‚≠ê <span id="starDisplay">0</span> / 3</div>
    </div>

    <div id="menuOverlay">
        <h1 style="font-size: 4rem; margin-bottom: 20px; color: #4dd0e1; text-shadow: 0 0 20px #4dd0e1;">BUCKET JUMP</h1>
        <p style="margin-bottom: 30px; opacity: 0.8;">Space to Jump | A-D to Move</p>
        <button id="startBtn">START JUMPING</button>
    </div>
</div>

<script>
(function() {
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // --- AUDIO ENGINE (Procedural Synth) ---
    const Audio = {
        ctx: null,
        init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
        play(freq, type, duration, vol) {
            this.init();
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, this.ctx.currentTime + duration);
            gain.gain.setValueAtTime(vol, this.ctx.currentTime);
            gain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + duration);
            osc.connect(gain); gain.connect(this.ctx.destination);
            osc.start(); osc.stop(this.ctx.currentTime + duration);
        },
        jump() { this.play(400, 'sine', 0.2, 0.1); },
        land() { this.play(150, 'triangle', 0.1, 0.1); },
        coin() { 
            this.play(800, 'square', 0.1, 0.05); 
            setTimeout(() => this.play(1200, 'square', 0.1, 0.05), 50); 
        },
        death() { this.play(100, 'sawtooth', 0.5, 0.2); }
    };

    // --- GAME STATE ---
    let game = {
        level: 1, stars: 0, 
        platforms: [], stars_objs: [], hazards: [], particles: [],
        cameraX: 0, shake: 0, winWidth: 0
    };
    
    let keys = { a: false, d: false, space: false };
    let player;

    class Player {
        constructor() {
            this.x = 100; this.y = 300; this.w = 34; this.h = 34;
            this.vx = 0; this.vy = 0;
            this.jumpCount = 0;
            this.grounded = false;
            this.slosh = 0; // For water animation
        }

        update() {
            if (keys.a) this.vx -= 0.8;
            if (keys.d) this.vx += 0.8;
            this.vx *= 0.88;
            this.vy += 0.6; // Gravity
            this.x += this.vx;
            this.checkCollisions('x');
            this.y += this.vy;
            this.checkCollisions('y');

            this.slosh = (this.vx * 0.2) + (this.vy * 0.05);

            if (this.y > 600) this.die();
            
            // Item collection
            game.stars_objs.forEach(s => {
                if(!s.got && this.dist(s) < 30) {
                    s.got = true; game.stars++;
                    Audio.coin();
                    document.getElementById('starDisplay').innerText = game.stars;
                }
            });

            // Hazard collision
            game.hazards.forEach(h => {
                if(this.dist(h) < 25) this.die();
            });

            // Goal
            if (game.stars >= 3 && this.x > game.winWidth - 100) nextLevel();
        }

        dist(o) { return Math.hypot((this.x+17)-o.x, (this.y+17)-o.y); }

        checkCollisions(axis) {
            game.platforms.forEach(p => {
                if (this.x < p.x + p.w && this.x + this.w > p.x && this.y < p.y + p.h && this.y + this.h > p.y) {
                    if (axis === 'x') {
                        this.x = this.vx > 0 ? p.x - this.w : p.x + p.w;
                        this.vx = 0;
                    } else {
                        if (this.vy > 0) {
                            if (this.vy > 8) Audio.land();
                            this.y = p.y - this.h;
                            this.vy = 0; this.grounded = true; this.jumpCount = 0;
                        } else {
                            this.y = p.y + p.h; this.vy = 0;
                        }
                    }
                }
            });
        }

        die() {
            Audio.death();
            game.shake = 15;
            spawnParticles(this.x, this.y, '#4dd0e1', 20);
            setTimeout(() => startLevel(game.level), 500);
            this.x = -1000; // Move off screen
        }

        draw() {
            ctx.save();
            ctx.translate(this.x + 17, this.y + 34);
            ctx.rotate(this.vx * 0.03);
            
            // Bucket Shape
            ctx.fillStyle = '#4dd0e1';
            ctx.beginPath();
            ctx.moveTo(-17, -34); ctx.lineTo(17, -34);
            ctx.lineTo(12, 0); ctx.lineTo(-12, 0);
            ctx.fill();

            // Sloshing Water
            ctx.fillStyle = '#00b0ff';
            ctx.beginPath();
            ctx.moveTo(-14, -20 + this.slosh * 10);
            ctx.bezierCurveTo(0, -20 - this.slosh * 10, 0, -20 + this.slosh * 10, 14, -20 - this.slosh * 10);
            ctx.lineTo(10, -2); ctx.lineTo(-10, -2);
            ctx.fill();

            // Eyes
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.arc(-6, -24, 4, 0, 7); ctx.arc(6, -24, 4, 0, 7); ctx.fill();
            ctx.fillStyle = '#1a1a2e';
            ctx.beginPath(); ctx.arc(-6 + this.vx, -24, 2, 0, 7); ctx.arc(6 + this.vx, -24, 2, 0, 7); ctx.fill();
            ctx.restore();
        }
    }

    // --- LEVEL ENGINE ---
    function spawnParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            game.particles.push({
                x, y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                life: 1, c: color
            });
        }
    }

    function startLevel(n) {
        game.level = n; game.stars = 0; game.platforms = []; game.stars_objs = []; game.hazards = [];
        document.getElementById('levelDisplay').innerText = n;
        document.getElementById('starDisplay').innerText = "0";
        
        let cx = 0;
        game.platforms.push({x: 0, y: 400, w: 300, h: 100});
        cx = 350;

        for(let i=0; i<10 + n; i++) {
            let w = 80 + Math.random()*100;
            let y = 150 + Math.random()*250;
            game.platforms.push({x: cx, y: y, w: w, h: 30});
            if (i % 3 === 0) game.stars_objs.push({x: cx + w/2, y: y - 40, got: false});
            if (i > 2 && Math.random() > 0.7) game.hazards.push({x: cx + w/2, y: y - 100, base: y - 100});
            cx += w + 80 + Math.random()*70;
        }

        game.winWidth = cx + 200;
        game.platforms.push({x: cx, y: 400, w: 300, h: 100});
        player = new Player();
        document.getElementById('menuOverlay').style.display = 'none';
    }

    function nextLevel() {
        spawnParticles(player.x, player.y, '#ffd700', 30);
        setTimeout(() => startLevel(game.level + 1), 300);
    }

    function draw() {
        // Sky Gradient
        let grad = ctx.createLinearGradient(0, 0, 0, 500);
        grad.addColorStop(0, '#1a1a2e'); grad.addColorStop(1, '#16213e');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, 900, 500);

        ctx.save();
        if (game.shake > 0) {
            ctx.translate(Math.random()*game.shake, Math.random()*game.shake);
            game.shake *= 0.9;
        }

        game.cameraX = Math.max(0, player.x - 300);
        ctx.translate(-game.cameraX, 0);

        // Progress Bar update
        document.getElementById('progressBar').style.width = (player.x / game.winWidth * 100) + "%";

        // Draw World
        ctx.fillStyle = '#4dd0e1';
        game.platforms.forEach(p => {
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.fillRect(p.x, p.y, p.w, 5);
        });

        // Stars
        game.stars_objs.forEach(s => {
            if(s.got) return;
            ctx.fillStyle = '#ffd700';
            ctx.shadowBlur = 15; ctx.shadowColor = "yellow";
            ctx.beginPath(); ctx.arc(s.x, s.y + Math.sin(Date.now()/200)*10, 8, 0, 7); ctx.fill();
            ctx.shadowBlur = 0;
        });

        // Hazards
        game.hazards.forEach(h => {
            h.y = h.base + Math.sin(Date.now()/500)*50;
            ctx.fillStyle = '#ff4d4d';
            ctx.beginPath(); ctx.arc(h.x, h.y, 12, 0, 7); ctx.fill();
            // Spikes
            ctx.strokeStyle = '#ff4d4d';
            for(let i=0; i<8; i++) {
                ctx.beginPath(); ctx.moveTo(h.x, h.y);
                ctx.lineTo(h.x + Math.cos(i)*20, h.y + Math.sin(i)*20);
                ctx.stroke();
            }
        });

        // Goal Well
        ctx.fillStyle = '#ffd700';
        ctx.shadowBlur = 20; ctx.shadowColor = game.stars >= 3 ? "cyan" : "transparent";
        ctx.fillRect(game.winWidth - 120, 380, 80, 20);
        ctx.shadowBlur = 0;

        player.update();
        player.draw();

        // Particles
        game.particles.forEach((p, i) => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            ctx.fillStyle = p.c; ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 4, 4);
            if(p.life <= 0) game.particles.splice(i, 1);
        });
        ctx.globalAlpha = 1;

        ctx.restore();
        requestAnimationFrame(draw);
    }

    // Input
    window.onkeydown = e => {
        if(e.code === 'KeyA') keys.a = true;
        if(e.code === 'KeyD') keys.d = true;
        if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') {
            if (player.grounded || player.jumpCount < 1) {
                player.vy = -12;
                player.grounded = false;
                player.jumpCount++;
                Audio.jump();
                spawnParticles(player.x+17, player.y+34, 'white', 5);
            }
        }
    };
    window.onkeyup = e => {
        if(e.code === 'KeyA') keys.a = false;
        if(e.code === 'KeyD') keys.d = false;
    };

    document.getElementById('startBtn').onclick = () => {
        Audio.init();
        startLevel(1);
    };

    draw();
})();
</script>
</body>
</html>
