<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bucket Jump ¬∑ Infinite Trolls</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; user-select: none; margin: 0; padding: 0; }
        body {
            background: #fff0f5;
            background-image: radial-gradient(#e6e6fa 20%, transparent 20%), radial-gradient(#e6e6fa 20%, transparent 20%);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            min-height: 100vh;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Fredoka One', cursive; overflow: hidden;
        }
        .game-wrapper {
            background: #ffffff; border: 8px solid #ffb7b2; padding: 1rem;
            border-radius: 30px; box-shadow: 0 20px 50px rgba(255, 183, 178, 0.4);
            position: relative;
        }
        canvas {
            display: block; width: 100%; max-width: 1024px; aspect-ratio: 16 / 9;
            border-radius: 20px; background: linear-gradient(to bottom, #e0f7fa, #ffffff);
            cursor: none;
        }
        .ui-bar { display: flex; align-items: center; justify-content: space-between; margin-top: 16px; padding: 0 10px; }
        .stat-badge {
            background: #ffdac1; color: #ff6f61; padding: 10px 25px;
            border-radius: 50px; font-size: 1.5rem; box-shadow: 0 5px 0 #ffb7b2;
        }
        button {
            background: #b5ead7; border: none; color: #555; font-family: 'Fredoka One';
            font-size: 1.2rem; padding: 10px 25px; border-radius: 50px; cursor: pointer;
            box-shadow: 0 5px 0 #84dcc6; transition: all 0.1s;
        }
        button:active { transform: translateY(5px); box-shadow: 0 0 0 #84dcc6; }
        #menuOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95); display: flex;
            flex-direction: column; align-items: center; justify-content: center; z-index: 10;
        }
        .title-text { font-size: 4rem; color: #ff9aa2; margin-bottom: 2rem; animation: float 3s infinite; }
        @keyframes float { 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

<div class="game-wrapper">
    <canvas id="gameCanvas" width="1024" height="576"></canvas>
    <div class="ui-bar">
        <div class="stat-badge">‚≠ê Level <span id="levelDisplay">1</span></div>
        <button id="restartBtn">‚Ü∫ Restart</button>
        <div class="stat-badge" style="background: #e2f0cb; color: #6b8c42;">üíî Fails <span id="deathCounter">0</span></div>
    </div>

    <div id="menuOverlay">
        <div class="title-text">INFINITE BUCKET</div>
        <button style="font-size: 2rem; padding: 15px 50px;" id="startBtn">START</button>
    </div>
</div>

<script>
(function() {
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const levelSpan = document.getElementById('levelDisplay');
    const deathSpan = document.getElementById('deathCounter');
    const menuOverlay = document.getElementById('menuOverlay');

    let gameState = 'menu';
    let currentLevel = 1;
    let deaths = 0;

    class SoundManager {
        constructor() { this.ctx = null; }
        init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); }
        play(freq, type = 'sine', dur = 0.2) {
            this.init(); const osc = this.ctx.createOscillator(); const g = this.ctx.createGain();
            osc.connect(g); g.connect(this.ctx.destination);
            osc.type = type; osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
            g.gain.setValueAtTime(0.1, this.ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + dur);
            osc.start(); osc.stop(this.ctx.currentTime + dur);
        }
    }
    const sound = new SoundManager();

    class Player {
        constructor(x, y) {
            this.x = x; this.y = y; this.w = 30; this.h = 30;
            this.vx = 0; this.vy = 0; this.speed = 4.2;
            this.jumpPower = -11; this.grounded = false; this.alive = true;
        }
        update(platforms, traps) {
            if (!this.alive) return;
            this.vy += 0.6;
            this.x += this.vx; this.collide(platforms, 'x');
            this.y += this.vy; this.collide(platforms, 'y');
            for (let t of traps) if (this.collidesWith(t)) this.die();
            if (this.y > 600 || this.x < -20 || this.x > 1050) this.die();
        }
        collide(platforms, axis) {
            for (let p of platforms) {
                if (!p.active) continue;
                if (this.collidesWith(p)) {
                    if (axis === 'x') {
                        if (this.vx > 0) this.x = p.x - this.w;
                        else this.x = p.x + p.w;
                        this.vx = 0;
                    } else {
                        if (this.vy > 0) { this.y = p.y - this.h; this.vy = 0; this.grounded = true; }
                        else { this.y = p.y + p.h; this.vy = 0; }
                    }
                }
            }
        }
        collidesWith(o) {
            return this.x < o.x + o.w && this.x + this.w > o.x && this.y < o.y + o.h && this.y + this.h > o.y;
        }
        die() {
            if (this.alive) {
                this.alive = false; deaths++; deathSpan.innerText = deaths;
                sound.play(100, 'sawtooth'); setTimeout(resetLevel, 500);
            }
        }
        draw() {
            ctx.fillStyle = '#ff9aa2';
            ctx.fillRect(this.x, this.y, this.w, this.h);
            ctx.fillStyle = 'black';
            ctx.fillRect(this.x + (this.vx >= 0 ? 18 : 5), this.y + 8, 4, 4);
        }
    }

    class Platform {
        constructor(x, y, w, h, type = 'static') {
            this.x = x; this.y = y; this.w = w; this.h = h; this.type = type;
            this.active = true; this.initialY = y; this.timer = Math.random() * 10;
        }
        update() {
            if (this.type === 'fall' && player.collidesWith(this)) this.y += 6;
            if (this.type === 'lift') this.y = this.initialY + Math.sin(Date.now() / 500) * 70;
        }
        draw() {
            ctx.fillStyle = this.type === 'static' ? '#c7ceea' : '#b5ead7';
            ctx.fillRect(this.x, this.y, this.w, this.h);
        }
    }

    let player, platforms = [], traps = [], goal = { x: 0, y: 0 };
    let keys = {};

    function generateLevel(num) {
        platforms = [new Platform(50, 450, 100, 20)]; // Start
        traps = [];
        let curX = 150;
        let curY = 450;

        const count = 4 + Math.floor(num / 3);
        for (let i = 0; i < count; i++) {
            let gap = 120 + Math.min(num * 5, 100);
            let pW = Math.max(100 - (num * 2), 40);
            let type = Math.random() > 0.6 ? (Math.random() > 0.5 ? 'fall' : 'lift') : 'static';
            
            curX += gap;
            curY += (Math.random() - 0.5) * 150;
            curY = Math.max(150, Math.min(480, curY));

            platforms.push(new Platform(curX, curY, pW, 20, type));

            // Troll Spikes
            if (num > 1 && Math.random() > 0.5) {
                traps.push({ x: curX + 20, y: curY - 60, w: 30, h: 10, isSpike: true });
            }
        }

        goal = { x: curX + 20, y: curY - 50, w: 40, h: 40 };
        player = new Player(70, 400);
    }

    function resetLevel() { generateLevel(currentLevel); }

    document.getElementById('startBtn').onclick = () => {
        menuOverlay.style.display = 'none';
        gameState = 'playing';
        currentLevel = 1;
        levelSpan.innerText = 1;
        resetLevel();
    };

    document.getElementById('restartBtn').onclick = resetLevel;

    function loop() {
        ctx.clearRect(0, 0, 1024, 576);
        if (gameState === 'playing') {
            if (keys['ArrowLeft']) player.vx = -player.speed;
            else if (keys['ArrowRight']) player.vx = player.speed;
            else player.vx = 0;
            if (keys['ArrowUp'] || keys[' ']) { if (player.grounded) { player.vy = player.jumpPower; player.grounded = false; sound.play(300); } }

            platforms.forEach(p => { p.update(); p.draw(); });
            
            ctx.fillStyle = '#ff6f61';
            traps.forEach(t => ctx.fillRect(t.x, t.y, t.w, t.h));

            ctx.fillStyle = '#ffd700';
            ctx.fillRect(goal.x, goal.y, goal.w, goal.h);

            player.update(platforms, traps);
            player.draw();

            if (player.collidesWith(goal)) {
                currentLevel++;
                levelSpan.innerText = currentLevel;
                sound.play(500);
                resetLevel();
            }
        }
        requestAnimationFrame(loop);
    }

    window.onkeydown = e => keys[e.key] = true;
    window.onkeyup = e => keys[e.key] = false;
    loop();
})();
</script>
</body>
</html>
