<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bucket Jump: Deluxe ü™£</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; user-select: none; margin: 0; padding: 0; }
        body {
            background: #263238;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
        }
        .game-wrapper {
            background: #ffffff;
            border: 8px solid #4dd0e1;
            padding: 10px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
        }
        canvas {
            display: block;
            width: 100%;
            max-width: 1024px;
            aspect-ratio: 16 / 9;
            border-radius: 20px;
            background: #e1f5fe;
            cursor: crosshair;
        }
        .ui-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            padding: 0 10px;
        }
        .stat-badge {
            background: #e0f7fa;
            color: #0097a7;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 1.1rem;
            box-shadow: 0 4px 0 #b2ebf2;
        }
        button {
            background: #4dd0e1;
            border: none;
            color: white;
            font-family: 'Fredoka One', cursive;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #00acc1;
            transition: 0.1s;
        }
        button:active { transform: translateY(3px); box-shadow: 0 1px 0 #00acc1; }
        
        #menuOverlay, #winOverlay, #levelTransition {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        #menuOverlay { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(8px); }
        #levelTransition { background: #4dd0e1; color: white; display: none; pointer-events: none; }
        
        .title-text {
            font-size: 5rem;
            color: #4dd0e1;
            text-shadow: 6px 6px 0 #b2ebf2;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        .lb-entry {
            display: flex; justify-content: space-between;
            width: 280px; padding: 8px 15px; background: white;
            margin: 4px; border-radius: 10px; font-size: 0.9rem;
        }
        .highlight { background: #fff9c4; border: 2px solid #fbc02d; }
    </style>
</head>
<body>

<div class="game-wrapper">
    <canvas id="gameCanvas" width="1024" height="576"></canvas>

    <div class="ui-bar">
        <div class="stat-badge">üö© <span id="levelDisplay">1</span>/30</div>
        <div class="btn-group">
            <button id="restartBtn">‚Ü∫ Retry</button>
            <button id="menuBtn">‚åÇ Menu</button>
        </div>
        <div class="stat-badge" style="background: #fff9c4; color: #fbc02d;">‚≠ê <span id="starDisplay">0</span>/3</div>
    </div>

    <div id="menuOverlay">
        <div class="title-text">BUCKET JUMP</div>
        <button style="font-size: 2rem; padding: 15px 60px; background: #ff7043; box-shadow: 0 8px 0 #d84315;" id="startBtn">PLAY</button>
        <div id="lb-list" style="margin-top: 20px;"></div>
    </div>

    <div id="levelTransition">
        <h1 id="levelTitle" style="font-size: 4rem;">LEVEL 1</h1>
    </div>
</div>

<script>
(function() {
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // --- SETTINGS & STATE ---
    const GRAVITY = 0.5;
    const FRICTION = 0.85;
    const JUMP_FORCE = -12;
    let shake = 0;
    let gameData = { level: 1, stars: 0, objects: [], particles: [], clouds: [] };
    let player;
    let keys = { left: false, right: false, jump: false };
    let gameState = 'menu';

    // Cloud Background Generation
    for(let i=0; i<10; i++) {
        gameData.clouds.push({
            x: Math.random() * 2000, 
            y: Math.random() * 300, 
            s: 0.2 + Math.random() * 0.5,
            w: 100 + Math.random() * 100
        });
    }

    // --- CLASSES ---
    class Player {
        constructor(x, y) {
            this.x = x; this.y = y; this.w = 36; this.h = 36;
            this.vx = 0; this.vy = 0;
            this.grounded = false;
            this.rot = 0;
            this.sx = 1; this.sy = 1;
            this.alive = true;
        }

        update(platforms, traps, stars, goal) {
            if (!this.alive) return;

            // Input
            if (keys.left) this.vx -= 0.8;
            if (keys.right) this.vx += 0.8;
            this.vx *= FRICTION;
            this.vy += GRAVITY;

            // Jump
            if (keys.jump && this.grounded) {
                this.vy = JUMP_FORCE;
                this.grounded = false;
                this.sx = 0.6; this.sy = 1.4;
                spawnParticles(this.x + 18, this.y + 36, '#fff', 8);
            }

            // Move X
            this.x += this.vx;
            this.checkCollision(platforms, 'x');

            // Move Y
            this.y += this.vy;
            this.grounded = false;
            this.checkCollision(platforms, 'y');

            // Decay squash
            this.sx += (1 - this.sx) * 0.2;
            this.sy += (1 - this.sy) * 0.2;
            this.rot = this.vx * 0.05;

            // Hazards & Items
            if (this.y > 600) this.die();
            traps.forEach(t => { if(this.collides(t)) this.die(); });
            stars.forEach(s => {
                if(!s.collected && this.collides(s)) {
                    s.collected = true;
                    gameData.stars++;
                    document.getElementById('starDisplay').innerText = gameData.stars;
                    spawnParticles(s.x, s.y, '#ffd700', 15);
                }
            });

            if (gameData.stars >= 3 && this.collides(goal)) nextLevel();
        }

        checkCollision(platforms, axis) {
            platforms.forEach(p => {
                if (this.collides(p)) {
                    if (axis === 'x') {
                        if (this.vx > 0) this.x = p.x - this.w;
                        else this.x = p.x + p.w;
                        this.vx = 0;
                    } else {
                        if (this.vy > 0) {
                            this.y = p.y - this.h;
                            this.grounded = true;
                            if (this.vy > 5) { this.sx = 1.4; this.sy = 0.6; }
                            this.vy = 0;
                        } else {
                            this.y = p.y + p.h;
                            this.vy = 0;
                        }
                    }
                }
            });
        }

        collides(o) {
            return this.x < o.x + o.w && this.x + this.w > o.x && this.y < o.y + o.h && this.y + this.h > o.y;
        }

        die() {
            if (!this.alive) return;
            this.alive = false;
            shake = 15;
            spawnParticles(this.x+18, this.y+18, '#ff5252', 25);
            setTimeout(resetLevel, 600);
        }

        draw(ctx) {
            if(!this.alive) return;
            ctx.save();
            ctx.translate(this.x + 18, this.y + 36);
            ctx.rotate(this.rot);
            ctx.scale(this.sx, this.sy);
            
            // Bucket Body
            ctx.fillStyle = '#4dd0e1';
            ctx.beginPath();
            ctx.moveTo(-18, -36); ctx.lineTo(18, -36);
            ctx.lineTo(13, 0); ctx.lineTo(-13, 0);
            ctx.fill();
            
            // Eyes
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.arc(-7, -20, 5, 0, 7); ctx.fill();
            ctx.beginPath(); ctx.arc(7, -20, 5, 0, 7); ctx.fill();
            ctx.fillStyle = '#263238';
            ctx.beginPath(); ctx.arc(-7 + this.vx*0.5, -20, 2, 0, 7); ctx.fill();
            ctx.beginPath(); ctx.arc(7 + this.vx*0.5, -20, 2, 0, 7); ctx.fill();
            
            ctx.restore();
        }
    }

    // --- GAME ENGINE ---
    function spawnParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            gameData.particles.push({
                x, y, 
                vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                life: 1.0, c: color, s: Math.random()*5+2
            });
        }
    }

    function generateLevel(n) {
        let platforms = [ {x: 0, y: 450, w: 250, h: 40} ];
        let stars = [];
        let traps = [];
        let cx = 250;
        
        for(let i=0; i<8 + n/2; i++) {
            cx += 100 + Math.random()*100;
            let cy = 200 + Math.random()*300;
            let w = 100 + Math.random()*100;
            platforms.push({x: cx, y: cy, w: w, h: 30});
            if (i % 3 === 0) stars.push({x: cx + w/2, y: cy - 40, w: 20, h: 20, collected: false});
            if (i > 2 && Math.random() > 0.6) traps.push({x: cx + 20, y: cy - 20, w: 30, h: 20});
            cx += w;
        }
        
        let goal = { x: cx + 50, y: 350, w: 60, h: 80 };
        platforms.push({x: cx, y: 430, w: 200, h: 40});
        
        return { platforms, stars, traps, goal };
    }

    function startLevel(n) {
        gameState = 'playing';
        gameData.stars = 0;
        gameData.level = n;
        document.getElementById('levelDisplay').innerText = n;
        document.getElementById('starDisplay').innerText = "0";
        document.getElementById('menuOverlay').style.display = 'none';
        
        const lvl = generateLevel(n);
        gameData.platforms = lvl.platforms;
        gameData.stars_objs = lvl.stars;
        gameData.traps = lvl.traps;
        gameData.goal = lvl.goal;
        player = new Player(50, 300);
    }

    function nextLevel() {
        spawnParticles(gameData.goal.x + 30, gameData.goal.y + 40, '#ffeb3b', 40);
        setTimeout(() => {
            if(gameData.level < 30) startLevel(gameData.level + 1);
            else alert("YOU WIN EVERYTHING!");
        }, 500);
    }

    function resetLevel() { startLevel(gameData.level); }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        ctx.save();
        if (shake > 0) {
            ctx.translate(Math.random()*shake - shake/2, Math.random()*shake - shake/2);
            shake *= 0.9;
        }

        // Parallax Clouds
        let camX = player ? Math.max(0, player.x - 400) : 0;
        gameData.clouds.forEach(c => {
            ctx.fillStyle = 'white';
            ctx.globalAlpha = 0.4;
            ctx.beginPath();
            ctx.ellipse(c.x - camX * c.s, c.y, c.w, c.w/2, 0, 0, 7);
            ctx.fill();
        });
        ctx.globalAlpha = 1.0;

        ctx.translate(-camX, 0);

        // Draw Platforms
        gameData.platforms?.forEach(p => {
            ctx.fillStyle = '#81c784';
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.fillStyle = '#a5d6a7';
            ctx.fillRect(p.x, p.y, p.w, 8);
        });

        // Draw Goal (The Golden Well)
        if(gameData.goal) {
            let g = gameData.goal;
            ctx.fillStyle = '#5d4037';
            ctx.fillRect(g.x, g.y, g.w, g.h);
            ctx.fillStyle = gameData.stars >= 3 ? '#ffeb3b' : '#3e2723';
            ctx.beginPath();
            ctx.ellipse(g.x + 30, g.y, 30, 10, 0, 0, 7);
            ctx.fill();
            if(gameData.stars >= 3) { // Glow effect
                ctx.shadowBlur = 15; ctx.shadowColor = "yellow";
            }
        }

        // Draw Traps
        gameData.traps?.forEach(t => {
            ctx.fillStyle = '#e57373';
            ctx.beginPath();
            ctx.moveTo(t.x, t.y + t.h); ctx.lineTo(t.x + t.w/2, t.y); ctx.lineTo(t.x + t.w, t.y + t.h);
            ctx.fill();
        });

        // Draw Stars
        gameData.stars_objs?.forEach(s => {
            if(s.collected) return;
            ctx.fillStyle = '#fbc02d';
            ctx.beginPath(); ctx.arc(s.x, s.y + Math.sin(Date.now()/200)*5, 10, 0, 7); ctx.fill();
        });

        player?.update(gameData.platforms, gameData.traps, gameData.stars_objs, gameData.goal);
        player?.draw(ctx);

        // Particles
        gameData.particles = gameData.particles.filter(p => p.life > 0);
        gameData.particles.forEach(p => {
            p.x += p.vx; p.y += p.vy; p.life -= 0.02;
            ctx.fillStyle = p.c; ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, p.s, p.s);
        });
        ctx.globalAlpha = 1;

        ctx.restore();
        requestAnimationFrame(draw);
    }

    // Input
    window.onkeydown = e => {
        if(e.code === 'ArrowLeft' || e.code === 'KeyA') keys.left = true;
        if(e.code === 'ArrowRight' || e.code === 'KeyD') keys.right = true;
        if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') keys.jump = true;
    };
    window.onkeyup = e => {
        if(e.code === 'ArrowLeft' || e.code === 'KeyA') keys.left = false;
        if(e.code === 'ArrowRight' || e.code === 'KeyD') keys.right = false;
        if(e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') keys.jump = false;
    };

    document.getElementById('startBtn').onclick = () => startLevel(1);
    document.getElementById('restartBtn').onclick = () => resetLevel();
    document.getElementById('menuBtn').onclick = () => location.reload();

    draw();
})();
</script>
</body>
</html>
