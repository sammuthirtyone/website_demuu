<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bucket Jump Adventure</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #ffe6e6;
            --primary: #ff9aa2;
            --secondary: #b5ead7;
            --accent: #ffdac1;
            --text: #555;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg-color);
            background-image: radial-gradient(#ffffff 20%, transparent 20%);
            background-size: 30px 30px;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
        }

        /* GAME CONTAINER */
        #game-container {
            position: relative;
            width: 100%;
            max-width: 960px;
            aspect-ratio: 16/9;
            background: linear-gradient(to bottom, #e0f7fa, #ffffff);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* UI OVERLAYS */
        .overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.95);
            z-index: 10;
            transition: opacity 0.3s;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            z-index: 0;
        }

        h1 {
            font-size: 4rem;
            color: var(--primary);
            text-shadow: 4px 4px 0 var(--accent);
            margin-bottom: 20px;
            animation: bounce 2s infinite;
            text-align: center;
            line-height: 1;
        }

        /* BUTTONS */
        button {
            background: var(--secondary);
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            font-family: inherit;
            font-size: 1.5rem;
            color: white;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
            cursor: pointer;
            box-shadow: 0 6px 0 #88cbb6;
            transition: transform 0.1s, filter 0.1s;
            margin: 10px;
        }

        button:active {
            transform: translateY(6px);
            box-shadow: 0 0 0 #88cbb6;
        }

        button:hover {
            filter: brightness(1.1);
        }

        button.small-btn {
            font-size: 1rem;
            padding: 8px 20px;
            background: var(--primary);
            box-shadow: 0 4px 0 #e07a82;
        }
        button.small-btn:active { box-shadow: none; }

        /* LOADING BAR */
        .loading-container {
            width: 60%;
            height: 20px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
        }
        .loading-bar {
            width: 0%;
            height: 100%;
            background: var(--primary);
            transition: width 0.2s;
        }

        /* HUD */
        .hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none; /* Let clicks pass through */
        }

        .score-pill {
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 1.2rem;
            color: var(--text);
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* MOBILE CONTROLS */
        .mobile-controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none; /* Let gameplay touches pass, buttons catch them */
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            pointer-events: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 2px solid white;
            color: var(--primary);
            user-select: none;
        }
        .control-btn:active {
            background: white;
            transform: scale(0.9);
        }

        /* Animations */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* Hide mobile controls on desktop (basic detection) */
        @media (min-width: 1025px) {
            .mobile-controls { display: none; }
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div class="hud" id="game-hud" style="display:none;">
        <div class="score-pill">⭐ <span id="score">0</span></div>
        <div style="pointer-events: auto;">
            <button class="small-btn" id="hud-menu">Menu</button>
        </div>
    </div>

    <div id="menu-overlay" class="overlay">
        <h1>BUCKET<br>JUMP</h1>
        <button id="btn-play">▶ PLAY GAME</button>
        <p style="margin-top:20px; color: #888;">Use Arrows / Space / Touch</p>
    </div>

    <div id="loading-overlay" class="overlay hidden">
        <h2 style="color: var(--primary)">Loading World...</h2>
        <div class="loading-container">
            <div class="loading-bar" id="progress-bar"></div>
        </div>
    </div>

    <div id="result-overlay" class="overlay hidden">
        <h1 id="result-title">YOU WON!</h1>
        <p style="font-size: 1.5rem; color: var(--text); margin-bottom: 20px;">Score: <span id="final-score">0</span></p>
        <button id="btn-restart">↺ PLAY AGAIN</button>
        <button class="small-btn" id="btn-home" style="background:#eee; color:#555; box-shadow: 0 4px 0 #ccc;">Home</button>
    </div>

    <div class="mobile-controls" id="mobile-controls" style="display:none;">
        <div style="display:flex; gap:10px;">
            <div class="control-btn" id="btn-left">⬅</div>
            <div class="control-btn" id="btn-right">➡</div>
        </div>
        <div class="control-btn" id="btn-jump" style="background: var(--primary); color: white;">⬆</div>
    </div>
</div>

<script>
    // --- AUDIO SYSTEM (Simple & Cute) ---
    const AudioSys = {
        ctx: null,
        init: function() {
            if (!this.ctx) {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (this.ctx.state === 'suspended') {
                this.ctx.resume();
            }
        },
        play: function(type) {
            if (!this.ctx) return;
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            osc.connect(gain);
            gain.connect(this.ctx.destination);
            
            const now = this.ctx.currentTime;
            
            if (type === 'jump') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'coin') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.setValueAtTime(1600, now + 0.05);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'die') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(50, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            }
        }
    };

    // --- GAME ENGINE ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Game State
    let gameState = 'menu'; // menu, loading, playing, gameover
    let score = 0;
    let particles = [];
    let cameraY = 0; // For vertical scrolling if needed, currently static for simplicity
    
    // Physics Constants
    const GRAVITY = 0.6;
    const SPEED = 5;
    const JUMP_FORCE = -11;

    // Keys
    const keys = { left: false, right: false, up: false };

    // --- ENTITIES ---
    class Player {
        constructor(x, y) {
            this.x = x; this.y = y;
            this.w = 40; this.h = 40;
            this.vx = 0; this.vy = 0;
            this.grounded = false;
            this.dead = false;
            this.facingRight = true;
            this.squash = 1; // Animation scale X
            this.stretch = 1; // Animation scale Y
        }

        update(platforms) {
            if (this.dead) return;

            // Horizontal Movement
            if (keys.left) { this.vx = -SPEED; this.facingRight = false; }
            else if (keys.right) { this.vx = SPEED; this.facingRight = true; }
            else { this.vx *= 0.8; } // Friction

            // Jump
            if (keys.up && this.grounded) {
                this.vy = JUMP_FORCE;
                this.grounded = false;
                this.stretch = 1.3;
                this.squash = 0.7;
                AudioSys.play('jump');
                createParticles(this.x + this.w/2, this.y + this.h, '#fff', 5);
            }

            // Apply Physics
            this.vy += GRAVITY;
            this.x += this.vx;
            this.y += this.vy;

            // Return shape to normal
            this.squash += (1 - this.squash) * 0.1;
            this.stretch += (1 - this.stretch) * 0.1;

            // Collisions
            this.grounded = false;
            
            // Screen Boundaries
            if (this.x < 0) this.x = 0;
            if (this.x > canvas.width - this.w) this.x = canvas.width - this.w;
            if (this.y > canvas.height + 100) this.die(); // Fell off

            // Platform Collisions
            platforms.forEach(p => {
                // Only collide if coming from top
                if (this.vy > 0 && 
                    this.y + this.h > p.y && 
                    this.y + this.h < p.y + p.h + this.vy &&
                    this.x + this.w > p.x + 5 && 
                    this.x < p.x + p.w - 5) {
                    
                    this.y = p.y - this.h;
                    this.vy = 0;
                    this.grounded = true;
                    // Landing squish
                    if (this.stretch > 0.9) {
                        this.squash = 1.2;
                        this.stretch = 0.8;
                    }
                }
            });
        }

        die() {
            if (this.dead) return;
            this.dead = true;
            AudioSys.play('die');
            createParticles(this.x + this.w/2, this.y + this.h/2, '#ff9aa2', 20);
            setTimeout(() => {
                showResult(false);
            }, 800);
        }

        draw() {
            if (this.dead) return;

            ctx.save();
            // Pivot point at bottom center for squash/stretch
            ctx.translate(this.x + this.w/2, this.y + this.h);
            ctx.scale(this.squash, this.stretch);
            ctx.translate(-(this.x + this.w/2), -(this.y + this.h));

            // Draw Bucket
            ctx.fillStyle = '#ff9aa2'; // Cute Pink
            ctx.beginPath();
            // Trapezoid shape
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x + this.w, this.y);
            ctx.lineTo(this.x + this.w - 5, this.y + this.h);
            ctx.lineTo(this.x + 5, this.y + this.h);
            ctx.closePath();
            ctx.fill();

            // Rim
            ctx.fillStyle = '#ffb7b2';
            ctx.beginPath();
            ctx.ellipse(this.x + this.w/2, this.y, this.w/2, 5, 0, 0, Math.PI*2);
            ctx.fill();

            // Handle
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(this.x + this.w/2, this.y, this.w/2, Math.PI, 0);
            ctx.stroke();

            // Eyes (Look direction)
            const eyeX = this.facingRight ? 4 : -4;
            ctx.fillStyle = 'white';
            ctx.beginPath(); 
            ctx.arc(this.x + this.w/2 - 8 + eyeX, this.y + 15, 6, 0, Math.PI*2);
            ctx.arc(this.x + this.w/2 + 8 + eyeX, this.y + 15, 6, 0, Math.PI*2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath(); 
            ctx.arc(this.x + this.w/2 - 8 + eyeX + this.vx*0.2, this.y + 15, 2.5, 0, Math.PI*2);
            ctx.arc(this.x + this.w/2 + 8 + eyeX + this.vx*0.2, this.y + 15, 2.5, 0, Math.PI*2);
            ctx.fill();

            ctx.restore();
        }
    }

    class Platform {
        constructor(x, y, w) {
            this.x = x; this.y = y; this.w = w; this.h = 20;
        }
        draw() {
            // Cloud look
            ctx.fillStyle = '#b5ead7';
            ctx.beginPath();
            // Main block
            ctx.roundRect(this.x, this.y, this.w, this.h, 10);
            ctx.fill();
            // Cloud bumps
            ctx.beginPath();
            ctx.arc(this.x + 10, this.y + this.h, 8, 0, Math.PI*2);
            ctx.arc(this.x + this.w - 10, this.y + this.h, 10, 0, Math.PI*2);
            ctx.fill();
            
            // Highlight
            ctx.fillStyle = 'rgba(255,255,255,0.4)';
            ctx.fillRect(this.x + 5, this.y + 2, this.w - 10, 5);
        }
    }

    class Coin {
        constructor(x, y) {
            this.x = x; this.y = y;
            this.size = 15;
            this.collected = false;
            this.bob = 0;
        }
        update() {
            this.bob += 0.1;
            const floatY = this.y + Math.sin(this.bob) * 5;
            
            // Collision
            const dx = (player.x + player.w/2) - this.x;
            const dy = (player.y + player.h/2) - floatY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            if (dist < this.size + player.w/2) {
                this.collected = true;
                score += 100;
                document.getElementById('score').innerText = score;
                AudioSys.play('coin');
                createParticles(this.x, floatY, '#ffd700', 8);
            }
        }
        draw() {
            if (this.collected) return;
            const floatY = this.y + Math.sin(this.bob) * 5;
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            // Star shape
            for (let i=0; i<5; i++) {
                ctx.lineTo(Math.cos((18 + i * 72)/180*Math.PI) * this.size + this.x,
                           -Math.sin((18 + i * 72)/180*Math.PI) * this.size + floatY);
                ctx.lineTo(Math.cos((54 + i * 72)/180*Math.PI) * (this.size/2) + this.x,
                           -Math.sin((54 + i * 72)/180*Math.PI) * (this.size/2) + floatY);
            }
            ctx.closePath();
            ctx.fill();
        }
    }

    class Goal {
        constructor(x, y) {
            this.x = x; this.y = y;
            this.w = 40; this.h = 60;
        }
        update() {
            if (player.x < this.x + this.w && player.x + player.w > this.x &&
                player.y < this.y + this.h && player.y + player.h > this.y) {
                showResult(true);
            }
        }
        draw() {
            ctx.fillStyle = '#c7ceea'; // Periwinkle portal
            ctx.beginPath();
            ctx.ellipse(this.x + this.w/2, this.y + this.h/2, this.w/2, this.h/2, 0, 0, Math.PI*2);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.stroke();
            // Swirl
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.beginPath();
            ctx.ellipse(this.x + this.w/2, this.y + this.h/2, this.w/4, this.h/4, Date.now()/200, 0, Math.PI*1.5);
            ctx.stroke();
        }
    }

    // --- SYSTEMS ---
    let player;
    let platforms = [];
    let coins = [];
    let goal;

    function initLevel() {
        score = 0;
        document.getElementById('score').innerText = '0';
        player = new Player(50, 300);
        
        // Procedural-ish level generation
        platforms = [
            new Platform(50, 450, 200),
            new Platform(300, 400, 150),
            new Platform(500, 320, 100),
            new Platform(250, 250, 120),
            new Platform(50, 150, 150),
            new Platform(400, 150, 200),
            new Platform(700, 250, 150),
            new Platform(650, 450, 200),
        ];

        coins = [
            new Coin(375, 360),
            new Coin(550, 280),
            new Coin(310, 210),
            new Coin(125, 110),
            new Coin(750, 210),
        ];

        goal = new Goal(800, 400); // Bottom right
    }

    function createParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            particles.push({
                x: x, y: y,
                vx: (Math.random()-0.5) * 6,
                vy: (Math.random()-0.5) * 6,
                life: 1.0,
                color: color
            });
        }
    }

    // --- MAIN LOOP ---
    function loop() {
        if (gameState !== 'playing') return;
        
        // Clear
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Update
        player.update(platforms);
        coins.forEach(c => c.update());
        goal.update();

        // Particles
        for(let i=particles.length-1; i>=0; i--) {
            let p = particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life -= 0.05;
            if(p.life <= 0) {
                particles.splice(i, 1);
            } else {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
                ctx.fill();
            }
        }
        ctx.globalAlpha = 1;

        // Draw
        goal.draw();
        platforms.forEach(p => p.draw());
        coins.forEach(c => c.draw());
        player.draw();

        requestAnimationFrame(loop);
    }

    // --- UI LOGIC ---
    function startLoading() {
        document.getElementById('menu-overlay').classList.add('hidden');
        document.getElementById('loading-overlay').classList.remove('hidden');
        
        let progress = 0;
        const bar = document.getElementById('progress-bar');
        
        const interval = setInterval(() => {
            progress += 5;
            bar.style.width = progress + "%";
            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(startGame, 500);
            }
        }, 50);
    }

    function startGame() {
        gameState = 'playing';
        initLevel();
        document.getElementById('loading-overlay').classList.add('hidden');
        document.getElementById('result-overlay').classList.add('hidden');
        document.getElementById('game-hud').style.display = 'flex';
        document.getElementById('mobile-controls').style.display = 'flex';
        
        // Fix Canvas Resolution
        canvas.width = document.getElementById('game-container').offsetWidth;
        canvas.height = document.getElementById('game-container').offsetHeight;
        
        loop();
    }

    function showResult(win) {
        gameState = 'gameover';
        document.getElementById('game-hud').style.display = 'none';
        document.getElementById('mobile-controls').style.display = 'none';
        
        const overlay = document.getElementById('result-overlay');
        const title = document.getElementById('result-title');
        
        overlay.classList.remove('hidden');
        title.innerText = win ? "LEVEL CLEARED!" : "OOPS!";
        title.style.color = win ? "#b5ead7" : "#ff9aa2";
        document.getElementById('final-score').innerText = score;
        
        if (win) AudioSys.play('coin'); // Cheerful sound
    }

    // --- EVENT LISTENERS ---
    
    // 1. Wait for HTML to be ready
    document.addEventListener('DOMContentLoaded', () => {
        
        // Button Clicks
        document.getElementById('btn-play').addEventListener('click', () => {
            AudioSys.init(); // Initialize audio context on user gesture
            startLoading();
        });

        document.getElementById('btn-restart').addEventListener('click', () => {
            startGame();
        });

        document.getElementById('btn-home').addEventListener('click', () => {
            document.getElementById('result-overlay').classList.add('hidden');
            document.getElementById('menu-overlay').classList.remove('hidden');
            gameState = 'menu';
        });

        document.getElementById('hud-menu').addEventListener('click', () => {
            gameState = 'menu';
            document.getElementById('game-hud').style.display = 'none';
            document.getElementById('mobile-controls').style.display = 'none';
            document.getElementById('menu-overlay').classList.remove('hidden');
        });

        // Keyboard Controls
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
            if (e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
            if (e.key === 'ArrowUp' || e.key === ' ' || e.key === 'w') keys.up = true;
        });

        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
            if (e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
            if (e.key === 'ArrowUp' || e.key === ' ' || e.key === 'w') keys.up = false;
        });

        // Mobile Touch Controls
        const setupTouch = (id, key) => {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mousedown', (e) => { keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { keys[key] = false; });
        };

        setupTouch('btn-left', 'left');
        setupTouch('btn-right', 'right');
        setupTouch('btn-jump', 'up');
    });

    // Resize Handler
    window.addEventListener('resize', () => {
        if(gameState === 'playing') {
            canvas.width = document.getElementById('game-container').offsetWidth;
            canvas.height = document.getElementById('game-container').offsetHeight;
            // A reset might be needed in a real full game, but this is okay for a demo
        }
    });

</script>
</body>
</html>
